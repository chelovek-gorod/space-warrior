var app;(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{CURSOR:()=>st,addToMaxAsteroids:()=>At,addToMaxEnemies:()=>yt,asteroidsArr:()=>Tt,bonusesArr:()=>bt,enemiesArr:()=>Mt,enemiesBulletsArr:()=>Yt,gameCursor:()=>gt,oneLoopObjectsArr:()=>vt,player:()=>ft,rocksArr:()=>St,smokeArr:()=>_t});const s={},i={},h={};let r=0,a=0;const n=new class{constructor(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.updateCanvasSizes()}updateCanvasSizes(){this.width=innerWidth,this.height=innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.centerX=Math.floor(this.width/2),this.centerY=Math.floor(this.height/2)}},o=class{constructor(t="",e=0,s=0,i){this.x=e,this.y=s,this.size=i.size||24,this.font=i.font||"Arial",this.color=i.color||"#00ff00",this.align=i.align||"left",this.fillTextX=0,this.drawTextX=e,this.img=document.createElement("canvas"),this.ctx=this.img.getContext("2d"),this.img.width=this.getTextWidth(t),this.img.height=this.size,this.render(t)}getTextWidth(t){return this.ctx.font=`${this.size}px ${this.font}, Arial, sans-serif`,this.ctx.measureText(t||" ").width}render(t){if(this.ctx.clearRect(0,0,this.img.width,this.img.height),this.img.width=this.getTextWidth(t),"left"!==this.align)switch(this.align){case"right":this.fillTextX=this.img.width,this.drawTextX=this.x-this.img.width;break;case"center":this.fillTextX=Math.floor(this.img.width/2),this.drawTextX=this.x-Math.floor(this.img.width/2);break;default:this.align="left"}this.ctx.font=`${this.size}px ${this.font}, Arial, sans-serif`,this.ctx.textBaseline="top",this.ctx.textAlign=this.align,this.ctx.fillStyle=this.color,this.ctx.fillText(t||" ",this.fillTextX,0)}draw(){n.context.drawImage(this.img,this.drawTextX,this.y)}},c=new class extends o{constructor(){super("FPS",n.width-2,n.height-12,{size:10,font:"PTSans",align:"right"}),this.updateTimeoutFPS=500,this.currentTimeFPS=0,this.frameCounter=0}update(t){if(this.frameCounter++,this.currentTimeFPS+=t,this.currentTimeFPS>=this.updateTimeoutFPS){const t=`FPS: ${(this.frameCounter/this.currentTimeFPS*1e3).toFixed(2)}`;this.render(t),this.frameCounter=0,this.currentTimeFPS=0}this.draw()}},l=new class extends o{constructor(){super("Performance",2,n.height-12,{size:10,font:"PTSans"}),this.updateTimeoutPerformance=500,this.currentTimePerformance=0,this.performanceTestStartTime=0,this.performanceArr=[]}start(){this.performanceTestStartTime=performance.now()}update(t){if(this.performanceArr.push(performance.now()-this.performanceTestStartTime),this.currentTimePerformance+=t,this.currentTimePerformance>=this.updateTimeoutPerformance){let t=0;for(let e=0;e<this.performanceArr.length;e++)t+=this.performanceArr[e];const e=`Performance: ${(t/this.performanceArr.length).toFixed(3)} ms`;this.render(e),this.performanceArr.length=0,this.currentTimePerformance=0}this.draw()}},d=new Audio;d.addEventListener("ended",g);let p=0,u=[],m="";function g(){d.src=m+u[p],d.play(),p++,p===u.length&&(p=0)}function f(t){i[t].currentTime=0,i[t].play()}let x,w,_=null,b=!1,T=!1,k=!1,A=!0;function S(t){const e=t-x;x=t,n.context.clearRect(0,0,n.width,n.height),k&&l.start(),_&&_(e),k&&l.update(e),T&&c.update(e),A&&(w=requestAnimationFrame(S))}window.onblur=function(){A=!1,console.log("screen onblur"),b||d.pause()},window.onfocus=function(){A||(A=!0,w&&cancelAnimationFrame(w),x=performance.now(),w=requestAnimationFrame(S),console.log("screen onfocus"),b||d.src&&d.play())};const M=2*Math.PI;function X(t){const e=[];for(let s=0;s<t.length;s++)t[s].isExist&&e.push(t[s]);return e}function y(t,e,s){let i=Math.atan2(e.centerY-t.centerY,e.centerX-t.centerX),h=i-t.direction%M;if(h){if(h<-Math.PI&&(h+=M),h>Math.PI&&(h-=M),Math.abs(h)<=s)return t.direction=i,void console.log("deflection 0");t.direction+=h<0?-s:s}}function Y(t,e){t.centerX+=Math.cos(t.direction)*e,t.centerY+=Math.sin(t.direction)*e}function v(t,e){let s=e.centerX-t.centerX,i=e.centerY-t.centerY;return Math.sqrt(s**2+i**2)}Math.PI;const D={x:0,y:0,isClick:!1,isContext:!1,isWheel:!1,isWheelUp:!1,isWheelDown:!1};document.onmousemove=t=>{D.x=t.pageX,D.y=t.pageY},document.oncontextmenu=t=>t.preventDefault(),document.onmousedown=t=>{switch(t.button){case 0:D.isClick=!0;break;case 1:D.isWheel=!0;break;case 2:D.isContext=!0}},document.onmouseup=t=>{switch(t.button){case 0:D.isClick=!1;break;case 1:D.isWheel=!1;break;case 2:D.isContext=!1}},document.onwheel=t=>{t.preventDefault(),t.deltaY>0&&(D.isWheelDown=!0),t.deltaY<0&&(D.isWheelUp=!0)};const E=D,z={x:0,y:0,isClick:!1};document.addEventListener("touchstart",(function(t){const e=t.touches[0];z.x=e.pageX,z.y=e.pageY,z.isClick=!0})),document.addEventListener("touchmove",(function(t){const e=t.touches[0];z.x=e.pageX,z.y=e.pageY})),document.addEventListener("touchend",(function(t){z.isClick=!1}));const P=z,W=class{constructor(t,e,i){this.img=s[t],this.centerX=e,this.centerY=i,this.width=this.img.width,this.height=this.img.height,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.direction=0}draw(){0===this.direction?n.context.drawImage(this.img,this.centerX-this.halfWidth,this.centerY-this.halfHeight):(n.context.setTransform(1,0,0,1,this.centerX,this.centerY),n.context.rotate(this.direction),n.context.drawImage(this.img,-this.halfWidth,-this.halfHeight),n.context.setTransform(1,0,0,1,0,0))}},H=class extends W{constructor(t,e,s){super("MarsGameLogoDarkBg2k.png",n.centerX,n.centerY),this.delayTime=t,this.showHideTime=e,this.visibleTime=s,this.alphaStepPerMillisecond=1/this.showHideTime,this.visibleState="emerging",this.isExist=!0,this.alpha=0}update(t){if(this.delayTime>0)this.delayTime-=t;else{switch(this.visibleState){case"emerging":this.alpha+=this.alphaStepPerMillisecond*t,this.alpha>=1&&(this.alpha=1,this.visibleState="visible");break;case"visible":this.visibleTime-=t,this.visibleTime<=0&&(this.visibleState="disappearing");break;default:this.alpha-=this.alphaStepPerMillisecond*t,this.alpha<=0&&(this.alpha=0,this.isExist=!1)}this.alpha<1&&(n.context.save(),n.context.globalAlpha=this.alpha),this.draw(),this.alpha<1&&n.context.restore()}}},C=class extends o{constructor(t,e,s,i,h,r,a){super(t,e,s,{size:i,font:"MicraDi",color:"#ffffff",align:"center"}),this.shadowColor="#0000ff",this.delayTime=h,this.showHideTime=r,this.visibleTime=a,this.alphaStepPerMillisecond=1/this.showHideTime,this.visibleState="emerging",this.isExist=!0,this.alpha=0}update(t){if(this.delayTime>0)this.delayTime-=t;else{switch(this.visibleState){case"emerging":this.alpha+=this.alphaStepPerMillisecond*t,this.alpha>=1&&(this.alpha=1,this.visibleState="visible");break;case"visible":this.visibleTime-=t,this.visibleTime<=0&&(this.visibleState="disappearing");break;default:this.alpha-=this.alphaStepPerMillisecond*t,this.alpha<=0&&(this.alpha=0,this.isExist=!1)}this.alpha<1&&(n.context.save(),n.context.globalAlpha=this.alpha),n.context.save(),n.context.shadowBlur=5,n.context.shadowColor=this.shadowColor,n.context.globalCompositeOperation="lighter",this.draw(),n.context.restore(),this.alpha<1&&n.context.restore()}}},F=class{constructor(t,e,i,h,r,a="left",n="top"){this.tile=s[t],this.x=e,this.y=i,this.width=h,this.height=r,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.img=document.createElement("canvas"),this.img.width=this.width,this.img.height=this.height,this.ctx=this.img.getContext("2d"),this.generateImage(h,r,a,n),this.direction=0}generateImage(t,e,s,i){let h=0,r=0;"center"===s&&(t>this.tile.width&&(h=-Math.floor((this.tile.width-t%this.tile.width)/2)),t<this.tile.width&&(h=-Math.floor((this.tile.width-t)/2))),"right"===s&&(t>this.tile.width&&(h=-(this.tile.width-t%this.tile.width)),t<this.tile.width&&(h=-(this.tile.width-t))),"center"===i&&(e>this.tile.height&&(r=-Math.floor((this.tile.height-e%this.tile.height)/2)),e<this.tile.height&&(r=-Math.floor((this.tile.height-e)/2))),"bottom"===i&&(e>this.tile.height&&(r=-(this.tile.height-e%this.tile.height)),e<this.tile.height&&(r=-(this.tile.height-e)));for(let s=r;s<e;s+=this.tile.height)for(let e=h;e<t;e+=this.tile.width)this.ctx.drawImage(this.tile,e,s)}draw(){0===this.direction?n.context.drawImage(this.img,this.x,this.y):(n.context.setTransform(1,0,0,1,this.x+this.halfWidth,this.y+this.halfHeight),n.context.rotate(this.direction),n.context.drawImage(this.img,-this.halfWidth,-this.halfHeight),n.context.setTransform(1,0,0,1,0,0))}},L=class extends F{constructor(t,e,s){super(t,0,...function(t){const e=(Math.ceil(n.height/t)+1)*t;return[-(e-n.height),n.width,e,"center","bottom"]}(e)),this.restartY=this.y,this.scrollSpeed=s}update(t){this.y+=this.scrollSpeed*t,this.y>0&&(this.y-=this.restartY),this.draw()}},I=class extends W{constructor(t,e,s,i,h,r=0){super(t,e,s),this.offsetY=i,this.scrollSpeed=h,this.rotationSpeed=r}update(t){this.rotationSpeed&&(this.direction+=this.rotationSpeed),this.centerY+=this.scrollSpeed*t,this.centerY-this.halfHeight>n.height&&(this.centerY-=this.offsetY+n.height),this.centerY+this.halfHeight>0&&this.centerY-this.halfHeight<n.height&&this.draw()}},O=class{constructor(t,e,i,h,r,a,n=60){this.img=s[t],this.centerX=e,this.centerY=i,this.width=h,this.height=r,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.framesArr=this.getFramesArr(h,r,a),this.frame=0,this.frames=a,this.nextFrameTimeout=Math.floor(1e3/n),this.nextFrameTime=this.nextFrameTimeout,this.direction=0}getFramesArr(t,e,s){const i=[];for(let s=0;s<this.img.height;s+=e)for(let e=0;e<this.img.width;e+=t)i.push({x:e,y:s});return i.length=s,i}drawWithAnimation(t){this.nextFrameTime-=t,this.nextFrameTime<0&&(this.nextFrameTime+=this.nextFrameTimeout,this.frame++,this.frame===this.frames&&(this.frame=0)),0===this.direction?this.draw():(n.context.setTransform(1,0,0,1,this.centerX,this.centerY),n.context.rotate(this.direction),this.draw(-this.halfWidth,-this.halfHeight),n.context.setTransform(1,0,0,1,0,0))}draw(t=this.centerX-this.halfWidth,e=this.centerY-this.halfHeight){n.context.drawImage(this.img,this.framesArr[this.frame].x,this.framesArr[this.frame].y,this.width,this.height,t,e,this.width,this.height)}},$=class extends O{constructor(){super("player_cursor_48x48px_16frames.png",0,0,48,48,16,12)}update(t){this.centerX=st.x,this.centerY=st.y,this.drawWithAnimation(t)}},R=class extends W{constructor(t,e,s,i){super("player_bullet_10x40px.png",t,e),this.speed=s,this.damage=i,this.isExist=!0}update(t){this.centerY-=this.speed*t,this.centerY<-this.halfHeight?this.isExist=!1:this.draw()}},K=class extends O{constructor(t,e,s,i,h,r,a=60){super(t,e,s,i,h,r,a),this.direction=Math.random()*Math.PI*2,this.isOnEnd=!1,this.isExist=!0}update(t){this.drawWithAnimation(t),this.frame===this.frames-1&&(this.isExist=!1)}},B=class extends W{constructor(t,e,s,i,h,r){super("player_rocket_30x12px.png",t,e),this.direction=-Math.PI/2,this.speed=s,this.acceleration=i,this.turnSpeed=h,this.damage=r,this.size=12,this.addSmokeTimeout=60,this.addSmokeTime=this.addSmokeTimeout,this.isExist=!0}update(t){let e=null,s=1/0;for(let t=0;t<Tt.length;t++){let i=v(this,Tt[t]);i<s&&(e=Tt[t],s=i)}for(let t=0;t<Mt.length;t++){let i=v(this,Mt[t]);i<s&&(e=Mt[t],s=i)}if(!e){this.isExist=!1,ft.rockets++;let t=new K("explosion_64x64px_17frames.png",this.centerX,this.centerY,64,64,17,30);return vt.push(t),void f("se_small_explosion.mp3")}if(y(this,e,this.turnSpeed),Y(this,this.speed*t),this.centerY<-this.halfHeight||this.centerY+this.halfHeight>n.height||this.centerX<-this.halfHeight||this.centerX+this.halfHeight>n.width)return ft.rockets++,void(this.isExist=!1);if(this.addSmokeTime-=t,this.addSmokeTime<0){this.addSmokeTime=this.addSmokeTimeout;let t=new K("smoke_32x32px_25frames.png",this.centerX,this.centerY,32,32,25,12);t.direction=Math.random()*(2*Math.PI),_t.push(t)}this.draw(),this.addSmokeTimeout/=this.acceleration,this.speed*=this.acceleration}},q={up:!1,down:!1,left:!1,right:!1,space:!1,q:!1};document.addEventListener("keydown",(t=>{switch(t.code){case"KeyA":case"ArrowLeft":q.left=!0;break;case"KeyD":case"ArrowRight":q.right=!0;break;case"KeyW":case"ArrowUp":q.up=!0;break;case"KeyS":case"ArrowDown":q.down=!0;break;case"Space":q.space=!0}})),document.addEventListener("keyup",(t=>{switch(t.code){case"KeyA":case"ArrowLeft":q.left=!1;break;case"KeyD":case"ArrowRight":q.right=!1;break;case"KeyW":case"ArrowUp":q.up=!1;break;case"KeyS":case"ArrowDown":q.down=!1;break;case"Space":q.space=!1}console.log("key code :",t.code)}));const j=q,U=class extends O{constructor(){super("player_74x100px_16frames.png",n.centerX,n.height+50,74,100,16,30),this.hp=100,this.scores=0,this.speed=1.2,this.hpText=new o("HP: 100%",6,6,{size:20,font:"MicraDi",color:"#ffffff",align:"left"}),this.scoresText=new o("Scores: 0",n.width-6,6,{size:20,font:"MicraDi",color:"#ffffff",align:"right"}),this.size=32,this.shutTimeout=1200,this.shutTime=this.shutTimeout,this.bulletSpeed=1.8,this.bulletDamage=10,this.bulletsArr=[],this.rockets=1,this.rocketLaunchTimeout=1e3,this.rocketLaunchTime=this.rocketLaunchTimeout,this.rocketStartSpeed=.1,this.rocketAcceleration=1.02,this.rocketTurnSpeed=.05,this.rocketDamage=30,this.rocketsArr=[]}addScores(t){this.scores+=t,this.scoresText.render(`Scores: ${this.scores}`)}addDamage(t){if(this.hp-=t,this.hp<1){this.bulletsArr=[],this.rocketsArr=[],this.centerY=2*n.height,this.hp=0,this.hpText.render("HP: 0%");let t=new K("explosion_200x200px_18frames.png",this.centerX,this.centerY,200,200,18,30);return vt.push(t),void f("se_explosion.mp3")}this.hpText.render(`HP: ${this.hp}%`)}update(t){if(this.shutTime-=t,this.shutTime<=0){this.shutTime+=this.shutTimeout;const t=new R(this.centerX,this.centerY,this.bulletSpeed,this.bulletDamage);this.bulletsArr.push(t),f("se_laser_shut.mp3")}for(let e=0;e<this.bulletsArr.length;e++)this.bulletsArr[e].update(t);if(this.bulletsArr=X(this.bulletsArr),this.rocketLaunchTime>0)this.rocketLaunchTime-=t;else if(this.rockets>0&&(st.isClick||j.space)){this.rockets--,this.rocketLaunchTime+=this.rocketLaunchTimeout;const t=new B(this.centerX,this.centerY,this.rocketStartSpeed,this.rocketAcceleration,this.rocketTurnSpeed,this.rocketDamage);this.rocketsArr.push(t),f("se_rocket_launch.mp3")}for(let e=0;e<this.rocketsArr.length;e++)this.rocketsArr[e].update(t);this.rocketsArr=X(this.rocketsArr),function(t,e,s){if(t.centerX!==e.centerX||t.centerY!==e.centerY){let i=v(t,e);if(i<=s)t.centerX=e.centerX,t.centerY=e.centerY;else{let h=s/i;t.centerX+=h*(e.centerX-t.centerX),t.centerY+=h*(e.centerY-t.centerY)}}}(this,gt,this.speed),this.drawWithAnimation(t)}},G=class extends O{constructor(t,e,s,i){super("rock_white_50x50px_8frames.png",t,e,50,50,8,18),this.speed=s,this.direction=i,this.damage=10,this.scores=5,this.size=24,this.isExist=!0}addDamage(){this.isExist=!1;let t=new K("explosion_64x64px_17frames.png",this.centerX,this.centerY,64,64,17,30);vt.push(t),f("se_small_explosion.mp3")}update(t){Y(this,this.speed*t);for(let t=0;t<Mt.length;t++)if(v(this,Mt[t])<this.size+Mt[t].size)return Mt[t].addDamage(this.damage,this),void(this.isExist=!1);for(let t=0;t<ft.bulletsArr.length;t++)if(v(this,ft.bulletsArr[t])<this.size)return ft.bulletsArr[t].isExist=!1,ft.addScores(5),void this.addDamage();for(let t=0;t<ft.rocketsArr.length;t++)if(v(this,ft.rocketsArr[t])<this.size)return ft.rockets++,ft.rocketsArr[t].isExist=!1,void this.addDamage();if(v(this,ft)<this.size+ft.size)return ft.addDamage(this.damage),void this.addDamage();this.centerY-this.halfHeight>n.height||this.centerY+this.halfHeight<0||this.centerX-this.halfWidth>n.width||this.centerX+this.halfWidth<0?this.isExist=!1:this.drawWithAnimation(t)}},V=class extends O{constructor(t,e){super("asteroid_white_90x108px_29frames.png",t,e,90,108,29,30),this.direction=Math.random()*(2*Math.PI),this.speed=.04+.04*Math.random(),this.sideSpeed=-this.speed/2+Math.random()*this.speed,this.hp=10+Math.ceil(20*Math.random()),this.damage=this.hp,this.scores=this.hp,this.size=36,this.isExist=!0}addDamage(t,e){if(this.hp-=t,this.hp>0){let t=new K("explosion_64x64px_17frames.png",e.centerX,e.centerY,64,64,17,30);vt.push(t),f("se_small_explosion.mp3")}else{this.isExist=!1,At();let t=new K("explosion_200x200px_18frames.png",this.centerX,this.centerY,200,200,18,30);vt.push(t),f("se_explosion.mp3"),e!==ft&&this.generateRocks()}}generateRocks(){let t=2+Math.ceil(3*Math.random()),e=2*Math.PI/t;for(let s=0;s<t;s++){let t=e*s+Math.random()*e;St.push(new G(this.centerX,this.centerY,2*this.speed,t))}}update(t){this.centerY+=this.speed*t,this.centerX+=this.sideSpeed*t;for(let t=0;t<St.length;t++)if(v(this,St[t])<this.size+St[t].size&&(St[t].isExist=!1,this.addDamage(St[t].damage,St[t]),this.hp<=0))return;for(let t=0;t<ft.bulletsArr.length;t++)if(v(this,ft.bulletsArr[t])<this.size){if(ft.bulletsArr[t].isExist=!1,this.addDamage(ft.bulletsArr[t].damage,ft.bulletsArr[t]),!(this.hp>0))return void ft.addScores(this.scores);ft.addScores(1)}for(let t=0;t<ft.rocketsArr.length;t++)if(v(this,ft.rocketsArr[t])<this.size&&(ft.rockets++,ft.rocketsArr[t].isExist=!1,this.addDamage(ft.rocketsArr[t].damage,ft.rocketsArr[t]),this.hp<=0))return void ft.addScores(Math.floor(this.scores/2));if(v(this,ft)<this.size+ft.size)return ft.addDamage(this.damage),void this.addDamage(this.hp,ft);this.centerY-this.halfHeight>n.height||this.centerX-this.halfWidth>n.width||this.centerX+this.halfWidth<0?this.isExist=!1:this.drawWithAnimation(t)}},J=class extends W{constructor(t,e,s,i){super("enemy_bullet_10x40px.png",t,e),this.speed=s,this.damage=i,this.isExist=!0}update(t){if(this.centerY+=this.speed*t,v(this,ft)<ft.size){this.isExist=!1,ft.addDamage(this.damage);let t=new K("explosion_64x64px_17frames.png",this.centerX,this.centerY,64,64,17,30);return vt.push(t),void f("se_small_explosion.mp3")}this.centerY>n.height+this.halfHeight?this.isExist=!1:this.draw()}},N=class extends W{constructor(t,e){super("enemy_52x78px.png",t,e),this.speed=.04+.04*Math.random(),this.sideSpeed=.04*Math.random()-.02,this.hp=20,this.damage=20,this.scores=this.hp,this.size=24,this.bulletSpeed=.2,this.bulletDamage=5,this.shutTimeout=2e3+Math.floor(1e3*Math.random()),this.shutTime=this.shutTimeout,this.isExist=!0}addDamage(t,e){if(this.hp-=t,this.hp>0){let t=new K("explosion_64x64px_17frames.png",e.centerX,e.centerY,64,64,17,30);vt.push(t),f("se_small_explosion.mp3")}else{this.isExist=!1,yt();let t=new K("explosion_200x200px_18frames.png",this.centerX,this.centerY,200,200,18,30);vt.push(t),f("se_explosion.mp3")}}update(t){if(this.centerY+=this.speed*t,this.centerX+=this.sideSpeed*t,this.centerY>0&&(this.shutTime-=t),this.shutTime<=0){this.shutTime+=this.shutTimeout;const t=new J(this.centerX,this.centerY,this.bulletSpeed,this.bulletDamage);Yt.push(t)}for(let t=0;t<ft.bulletsArr.length;t++)if(v(this,ft.bulletsArr[t])<this.size){if(ft.bulletsArr[t].isExist=!1,this.addDamage(ft.bulletsArr[t].damage,ft.bulletsArr[t]),!(this.hp>0))return void ft.addScores(this.scores);ft.addScores(1)}for(let t=0;t<ft.rocketsArr.length;t++)if(v(this,ft.rocketsArr[t])<this.size&&(ft.rockets++,ft.rocketsArr[t].isExist=!1,this.addDamage(ft.rocketsArr[t].damage,ft.rocketsArr[t]),this.hp<=0))return void ft.addScores(Math.floor(this.scores/2));if(v(this,ft)<this.size+ft.size)return ft.addDamage(this.damage),void this.addDamage(this.hp);this.centerY-this.halfHeight>n.height||this.centerX-this.halfWidth>n.width||this.centerX+this.halfWidth<0?this.isExist=!1:this.draw()}},Q=class extends W{constructor(t,e){super("bonus_empty_48x48px.png",t,e),this.type=this.getType(),this.img=s["bonus_"+this.type+"_48x48px.png"],this.speed=.05,this.size=22,this.isExist=!0}getType(){switch(Math.floor(5*Math.random())){case 0:return"bullets";case 1:return"rockets";case 2:return"repair";case 3:return"speed";default:return"scores"}}update(t){if(this.centerY+=this.speed*t,v(this,ft)<this.size+ft.size){switch(this.isExist=!1,this.type){case"bullets":ft.shutTimeout*=.8;break;case"rockets":ft.rockets+=1;break;case"repair":ft.addDamage(-20);break;case"speed":ft.speed*=1.2;break;default:ft.addScores(50)}f("se_bonus.mp3")}else this.centerY-this.halfHeight>n.height?this.isExist=!1:this.draw()}},Z=class extends W{constructor(t,e){super("enemy_100x130px.png",t,e),this.speed=.03+.03*Math.random(),this.sideSpeed=.02+.02*Math.random(),this.hp=40,this.damage=30,this.scores=this.hp,this.size=46,this.bulletSpeed=.2,this.bulletDamage=5,this.shutTimeout=1e3+Math.floor(1e3*Math.random()),this.shutTime=this.shutTimeout,this.isExist=!0}addDamage(t,e){if(this.hp-=t,this.hp>0){let t=new K("explosion_64x64px_17frames.png",e.centerX,e.centerY,64,64,17,30);vt.push(t),f("se_small_explosion.mp3")}else{this.isExist=!1,yt();let t=new K("explosion_200x200px_18frames.png",this.centerX,this.centerY,200,200,18,30);vt.push(t),f("se_explosion.mp3")}}update(t){if(this.centerY+=this.speed*t,this.centerX!==ft.centerX){let e=this.sideSpeed*t;Math.abs(this.centerX-ft.centerX)>e?this.centerX>ft.centerX?this.centerX-=e:this.centerX+=e:this.centerX=ft.centerX}if(this.centerY>0&&(this.shutTime-=t),this.shutTime<=0){this.shutTime+=this.shutTimeout;const t=new J(this.centerX,this.centerY,this.bulletSpeed,this.bulletDamage);Yt.push(t)}for(let t=0;t<ft.bulletsArr.length;t++)if(v(this,ft.bulletsArr[t])<this.size){if(ft.bulletsArr[t].isExist=!1,this.addDamage(ft.bulletsArr[t].damage,ft.bulletsArr[t]),!(this.hp>0))return ft.addScores(this.scores),void bt.push(new Q(this.centerX,this.centerY));ft.addScores(1)}for(let t=0;t<ft.rocketsArr.length;t++)if(v(this,ft.rocketsArr[t])<this.size&&(ft.rockets++,ft.rocketsArr[t].isExist=!1,this.addDamage(ft.rocketsArr[t].damage,ft.rocketsArr[t]),this.hp<=0))return void ft.addScores(Math.floor(this.scores/2));if(v(this,ft)<this.size+ft.size)return ft.addDamage(this.damage),void this.addDamage(this.hp);this.centerY-this.halfHeight>n.height||this.centerX-this.halfWidth>n.width||this.centerX+this.halfWidth<0?this.isExist=!1:this.draw()}},tt=class extends W{constructor(t,e){super("enemy_240x102px.png",t,e),this.speed=.12+.06*Math.random(),this.turnSpeed=.01+.01*Math.random(),this.hp=30,this.damage=this.hp,this.scores=this.hp,this.size=50,this.isExist=!0}addDamage(t,e){if(this.hp-=t,this.hp>0){let t=new K("explosion_64x64px_17frames.png",e.centerX,e.centerY,64,64,17,30);vt.push(t),f("se_small_explosion.mp3")}else{this.isExist=!1,yt();let t=new K("explosion_200x200px_18frames.png",this.centerX,this.centerY,200,200,18,30);vt.push(t),f("se_explosion.mp3")}}update(t){y(this,ft,this.turnSpeed*t),Y(this,this.speed*t);for(let t=0;t<ft.bulletsArr.length;t++)if(v(this,ft.bulletsArr[t])<this.size){if(ft.bulletsArr[t].isExist=!1,this.addDamage(ft.bulletsArr[t].damage,ft.bulletsArr[t]),!(this.hp>0))return void ft.addScores(this.scores);ft.addScores(1)}for(let t=0;t<ft.rocketsArr.length;t++)if(v(this,ft.rocketsArr[t])<this.size&&(ft.rockets++,ft.rocketsArr[t].isExist=!1,this.addDamage(ft.rocketsArr[t].damage,ft.rocketsArr[t]),this.hp<=0))return void ft.addScores(Math.floor(this.scores/2));if(v(this,ft)<this.size+ft.size)return ft.addDamage(this.damage),void this.addDamage(this.hp);this.centerY-this.halfHeight>n.height||this.centerX-this.halfWidth>n.width||this.centerX+this.halfWidth<0?this.isExist=!1:this.draw()}},et=class extends W{constructor(t,e){super("enemy_120x120px.png",t,e),this.speed=.02+.02*Math.random(),this.sideSpeed=.015+.015*Math.random(),this.rotationSpeed=.5*this.speed,this.hp=70,this.damage=40,this.scores=this.hp,this.size=52,this.shutDistance=320,this.shutDurationTimeout=500,this.shutDurationTime=this.shutDurationTimeout,this.shutDamage=.06,this.shutDamageStorage=0,this.shutTimeout=2e3+Math.floor(1e3*Math.random()),this.shutTime=this.shutTimeout,this.isExist=!0}addDamage(t,e){if(this.hp-=t,this.hp>0){let t=new K("explosion_64x64px_17frames.png",e.centerX,e.centerY,64,64,17,30);vt.push(t),f("se_small_explosion.mp3")}else{this.isExist=!1,yt();let t=new K("explosion_200x200px_18frames.png",this.centerX,this.centerY,200,200,18,30);vt.push(t),f("se_explosion.mp3")}}update(t){if(this.direction+=this.rotationSpeed,this.centerY+=this.speed*t,this.centerX!==ft.centerX){let e=this.sideSpeed*t;Math.abs(this.centerX-ft.centerX)>e?this.centerX>ft.centerX?this.centerX-=e:this.centerX+=e:this.centerX=ft.centerX}if(this.shutTime>0)this.shutTime-=t;else if(v(this,ft)<=this.shutDistance)if(this.shutDurationTime>0){if(this.shutDurationTime-=t,this.shutDamageStorage+=this.shutDamage*t,function(t,e,s=null){const i=["#ffe0ff","#e0ffff","#ffffe0"],h=s||i[Math.floor(Math.random()*i.length)];let r=v(t,e),a=Math.ceil(r/4+Math.random()*(r/8));const o=(t,e,s,i)=>{let h=t-s,r=e-i;return Math.sqrt(r*r+h*h)};let c=t.centerX,l=t.centerY;n.context.save(),n.context.lineWidth=2,n.context.strokeStyle=h,n.context.shadowBlur=6,n.context.shadowColor=h,n.context.globalCompositeOperation="lighter",n.context.beginPath(),n.context.moveTo(c,l);for(let t=a;t>1;t--){let s=o(c,l,e.centerX,e.centerY),i=6*Math.sin(s/r*Math.PI);c+=(e.centerX-c)/t+Math.random()*i*2-i,l+=(e.centerY-l)/t+Math.random()*i*2-i,n.context.lineTo(c,l)}n.context.stroke(),n.context.restore()}(this,ft),this.shutDamageStorage>1){let t=+this.shutDamageStorage.toFixed();ft.addDamage(t),this.shutDamageStorage-=t}}else this.shutTime+=this.shutTimeout,this.shutDurationTime+=this.shutDurationTimeout;for(let t=0;t<ft.bulletsArr.length;t++)if(v(this,ft.bulletsArr[t])<this.size){if(ft.bulletsArr[t].isExist=!1,this.addDamage(ft.bulletsArr[t].damage,ft.bulletsArr[t]),!(this.hp>0))return ft.addScores(this.scores),void bt.push(new Q(this.centerX,this.centerY));ft.addScores(1)}for(let t=0;t<ft.rocketsArr.length;t++)if(v(this,ft.rocketsArr[t])<this.size&&(ft.rockets++,ft.rocketsArr[t].isExist=!1,this.addDamage(ft.rocketsArr[t].damage,ft.rocketsArr[t]),this.hp<=0))return void ft.addScores(Math.floor(this.scores/2));if(v(this,ft)<this.size+ft.size)return ft.addDamage(this.damage),void this.addDamage(this.hp);this.centerY-this.halfHeight>n.height||this.centerX-this.halfWidth>n.width||this.centerX+this.halfWidth<0?this.isExist=!1:this.draw()}},st=navigator.userAgent.indexOf("Android")>0||navigator.userAgent.indexOf("iPhone")>0||navigator.userAgent.indexOf("iPad")>0||navigator.userAgent.indexOf("(X11;")>0?P:E;let it,ht,rt,at,nt;!function(t,e){r=t.images.arr.length+t.sounds.arr.length;const o=document.createElement("div");function c(){a++,o.innerHTML=`Loaded files: ${a}/${r}`,a===r&&function(){r=0,a=0,o.remove();const t=document.createElement("button");t.id="startButton",t.innerHTML="START",t.onclick=function(){t.remove(),function(){n.canvas.style.cursor="none",ot=new L("scrolling_bg_2000x3400px.png",3400,.01);const t=Math.floor(n.width/3);ct=new I("galaxy_480x420px.png",t,-420,4*n.height,.015,-2e-4),lt=new I("galaxy_480x420px.png",2*t,2*-n.height,4*n.height,.015,-2e-4),dt=new I("black_hole_left_320x320px.png",160,-n.height,48*n.height,.05),pt=new I("black_hole_right_320x320px.png",n.width-160,24*-n.height,48*n.height,.05),ut=new I("planets_920x760px.png",n.centerX,10*-n.height,60*n.height,.06,5e-4),mt=new I("planet_604x588px.png",n.centerX,12*-n.height,90*n.height,.08,6e-4),it=new H(100,1400,1400),ht=new C("Space Warrior",n.centerX,n.centerY-80,120,5500,1500,2500),rt=new C("Scrolling shooter",n.centerX,n.centerY+50,60,8e3,1500,0),at=new C("Click screen for start game",n.centerX,n.centerY,40,10700,300,1/0),gt=new $,ft=new U,function(t,e,s=0){d.pause(),p=s<e.length?s:0,m=t,u=e,g()}(h.path,h.arr,1),function(t,e=null){t&&(null===_&&document.body.prepend(n.canvas),_=t,e.isFPSdisplay&&(T=!0),e.isPerformanceDisplay&&(k=!0),e.isMusicPlayInOnblur&&(b=!0),w&&cancelAnimationFrame(w),x=performance.now(),w=requestAnimationFrame(S))}(Dt,{isFPSdisplay:!0,isPerformanceDisplay:!0,isMusicPlayInOnblur:!1}),nt=new C("GAME OVER",n.centerX,n.centerY,80,0,1e3,1/0)}()},document.body.append(t)}()}o.id="loadingStatusDiv",o.innerHTML=`Loaded files: ${a}/${r}`,document.body.append(o),t.images.arr.forEach((e=>function(e){s[e]=new Image,s[e].src=t.images.path+e,s[e].onload=()=>c()}(e))),t.sounds.arr.forEach((e=>function(e){i[e]=new Audio,i[e].src=t.sounds.path+e,i[e].oncanplaythrough=t=>{t.target.oncanplaythrough=null,c()}}(e))),h.path=t.music.path,h.arr=t.music.arr}({images:{path:"./src/images/",arr:["MarsGameLogoDarkBg2k.png","scrolling_bg_2000x3400px.png","black_hole_left_320x320px.png","black_hole_right_320x320px.png","galaxy_480x420px.png","planets_920x760px.png","planet_604x588px.png","player_74x100px_16frames.png","player_bullet_10x40px.png","player_rocket_30x12px.png","player_cursor_48x48px_16frames.png","explosion_200x200px_18frames.png","explosion_64x64px_17frames.png","smoke_32x32px_25frames.png","asteroid_white_90x108px_29frames.png","rock_white_50x50px_8frames.png","enemy_52x78px.png","enemy_100x130px.png","enemy_240x102px.png","enemy_120x120px.png","enemy_bullet_10x40px.png","bonus_empty_48x48px.png","bonus_bullets_48x48px.png","bonus_repair_48x48px.png","bonus_rockets_48x48px.png","bonus_scores_48x48px.png","bonus_speed_48x48px.png"]},sounds:{path:"./src/sounds/",arr:["se_explosion.mp3","se_small_explosion.mp3","se_laser_shut.mp3","se_rocket_launch.mp3","se_bonus.mp3"]},music:{path:"./src/music/",arr:["bgm_space_1.mp3","bgm_space_2.mp3","bgm_space_3.mp3"]}});let ot,ct,lt,dt,pt,ut,mt,gt,ft,xt=!1,wt=11e3,_t=[],bt=[],Tt=[],kt=3;function At(){kt+=.2}let St=[],Mt=[],Xt=2;function yt(){Xt+=.1}let Yt=[],vt=[];function Dt(t){if(ot.update(t),!xt)return wt>0?(wt-=t,!0===it.isExist&&it.update(t),!0===ht.isExist&&ht.update(t),!0===rt.isExist&&rt.update(t),void at.update(t)):(at.update(t),void(st.isClick&&(at.visibleTime=0,setTimeout((()=>{it.isExist=!1,ht.isExist=!1,rt.isExist=!1,at.isExist=!1,xt=!0}),500))));ct.update(t),lt.update(t),dt.update(t),pt.update(t),ut.update(t),mt.update(t),gt.update(t);for(let e=0;e<bt.length;e++)bt[e].update(t);bt=X(bt);for(let e=0;e<_t.length;e++)_t[e].update(t);_t=X(_t);for(let e=0;e<St.length;e++)St[e].update(t);St=X(St);for(let e=0;e<Yt.length;e++)Yt[e].update(t);Yt=X(Yt),Mt.length<Xt&&function(){let t,e=Math.random()*n.width,s=-Math.floor(Math.random()*n.height/2+n.height/2);switch(Math.floor(Math.random()*Math.floor(Xt))){case 0:t=new N(e,s);break;case 1:case 2:t=new Z(e,s);break;case 3:t=new tt(e,s);break;default:t=new et(e,s)}Mt.push(t),console.log(Mt)}();for(let e=0;e<Mt.length;e++)Mt[e].update(t);Mt=X(Mt),Tt.length<kt&&function(){let t=Math.random()*n.width,e=-Math.random()*n.centerX;Tt.push(new V(t,e))}();for(let e=0;e<Tt.length;e++)Tt[e].update(t);Tt=X(Tt),ft.hp>0?ft.update(t):nt.update(t);for(let e=0;e<vt.length;e++)vt[e].update(t);vt=X(vt),ft.scoresText.draw(),ft.hpText.draw()}app=e})();