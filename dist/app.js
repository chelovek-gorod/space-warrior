var app;(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{CURSOR:()=>rt,addToMaxAsteroids:()=>Mt,addToMaxEnemies:()=>Dt,asteroidsArr:()=>Xt,bonusesArr:()=>St,enemiesArr:()=>Et,enemiesBulletsArr:()=>Ct,gameCursor:()=>wt,messagesArr:()=>At,oneLoopObjectsArr:()=>Pt,player:()=>bt,rocksArr:()=>yt,smokeArr:()=>kt});const s={},i={},h={};let r=0,a=0;const n=new class{constructor(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.updateCanvasSizes()}updateCanvasSizes(){this.width=innerWidth,this.height=innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.centerX=Math.floor(this.width/2),this.centerY=Math.floor(this.height/2)}},o=class{constructor(t="",e=0,s=0,i){this.x=e,this.y=s,this.size=i.size||24,this.font=i.font||"Arial",this.color=i.color||"#00ff00",this.align=i.align||"left",this.fillTextX=0,this.drawTextX=e,this.img=document.createElement("canvas"),this.ctx=this.img.getContext("2d"),this.img.width=this.getTextWidth(t),this.img.height=this.size,this.render(t)}getTextWidth(t){return this.ctx.font=`${this.size}px ${this.font}, Arial, sans-serif`,this.ctx.measureText(t||" ").width}render(t){if(this.ctx.clearRect(0,0,this.img.width,this.img.height),this.img.width=this.getTextWidth(t),"left"!==this.align)switch(this.align){case"right":this.fillTextX=this.img.width,this.drawTextX=this.x-this.img.width;break;case"center":this.fillTextX=Math.floor(this.img.width/2),this.drawTextX=this.x-Math.floor(this.img.width/2);break;default:this.align="left"}this.ctx.font=`${this.size}px ${this.font}, Arial, sans-serif`,this.ctx.textBaseline="top",this.ctx.textAlign=this.align,this.ctx.fillStyle=this.color,this.ctx.fillText(t||" ",this.fillTextX,0)}draw(){n.context.drawImage(this.img,this.drawTextX,this.y)}},l=new class extends o{constructor(){super("FPS",n.width-2,n.height-12,{size:10,font:"PTSans",align:"right"}),this.updateTimeoutFPS=500,this.currentTimeFPS=0,this.frameCounter=0}update(t){if(this.frameCounter++,this.currentTimeFPS+=t,this.currentTimeFPS>=this.updateTimeoutFPS){const t=`FPS: ${(this.frameCounter/this.currentTimeFPS*1e3).toFixed(2)}`;this.render(t),this.frameCounter=0,this.currentTimeFPS=0}this.draw()}},c=new class extends o{constructor(){super("Performance",2,n.height-12,{size:10,font:"PTSans"}),this.updateTimeoutPerformance=500,this.currentTimePerformance=0,this.performanceTestStartTime=0,this.performanceArr=[]}start(){this.performanceTestStartTime=performance.now()}update(t){if(this.performanceArr.push(performance.now()-this.performanceTestStartTime),this.currentTimePerformance+=t,this.currentTimePerformance>=this.updateTimeoutPerformance){let t=0;for(let e=0;e<this.performanceArr.length;e++)t+=this.performanceArr[e];const e=`Performance: ${(t/this.performanceArr.length).toFixed(3)} ms`;this.render(e),this.performanceArr.length=0,this.currentTimePerformance=0}this.draw()}},d=new Audio;d.addEventListener("ended",g);let p=0,u=[],m="";function g(){d.src=m+u[p],d.play(),p++,p===u.length&&(p=0)}function x(t){i[t].currentTime=0,i[t].play()}let f,w,b=null,T=!1,_=!1,k=!1,S=!0;function A(t){const e=t-f;f=t,n.context.clearRect(0,0,n.width,n.height),k&&c.start(),b&&b(e),k&&c.update(e),_&&l.update(e),S&&(w=requestAnimationFrame(A))}window.onblur=function(){S=!1,console.log("screen onblur"),T||d.pause()},window.onfocus=function(){S||(S=!0,w&&cancelAnimationFrame(w),f=performance.now(),w=requestAnimationFrame(A),console.log("screen onfocus"),T||d.src&&d.play())};const X=2*Math.PI;function Y(t){const e=[];for(let s=0;s<t.length;s++)t[s].isExist&&e.push(t[s]);return e}function M(t,e,s){let i=Math.atan2(e.centerY-t.centerY,e.centerX-t.centerX),h=i-t.direction%X;if(h){if(h<-Math.PI&&(h+=X),h>Math.PI&&(h-=X),Math.abs(h)<=s)return t.direction=i,void console.log("deflection 0");t.direction+=h<0?-s:s}}function y(t,e){t.centerX+=Math.cos(t.direction)*e,t.centerY+=Math.sin(t.direction)*e}function E(t,e){let s=e.centerX-t.centerX,i=e.centerY-t.centerY;return Math.sqrt(s**2+i**2)}Math.PI;const v={x:0,y:0,isClick:!1,isContext:!1,isWheel:!1,isWheelUp:!1,isWheelDown:!1};document.onmousemove=t=>{v.x=t.pageX,v.y=t.pageY},document.oncontextmenu=t=>t.preventDefault(),document.onmousedown=t=>{switch(t.button){case 0:v.isClick=!0;break;case 1:v.isWheel=!0;break;case 2:v.isContext=!0}},document.onmouseup=t=>{switch(t.button){case 0:v.isClick=!1;break;case 1:v.isWheel=!1;break;case 2:v.isContext=!1}},document.onwheel=t=>{t.preventDefault(),t.deltaY>0&&(v.isWheelDown=!0),t.deltaY<0&&(v.isWheelUp=!0)};const D=v,C={x:0,y:0,isClick:!1};document.addEventListener("touchstart",(function(t){const e=t.touches[0];C.x=e.pageX,C.y=e.pageY,C.isClick=!0})),document.addEventListener("touchmove",(function(t){const e=t.touches[0];C.x=e.pageX,C.y=e.pageY})),document.addEventListener("touchend",(function(t){C.isClick=!1}));const P=C,W=class{constructor(t,e,i){this.img=s[t],this.centerX=e,this.centerY=i,this.width=this.img.width,this.height=this.img.height,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.direction=0}draw(){0===this.direction?n.context.drawImage(this.img,this.centerX-this.halfWidth,this.centerY-this.halfHeight):(n.context.setTransform(1,0,0,1,this.centerX,this.centerY),n.context.rotate(this.direction),n.context.drawImage(this.img,-this.halfWidth,-this.halfHeight),n.context.setTransform(1,0,0,1,0,0))}},z=class extends W{constructor(t,e,s){super("MarsGameLogoDarkBg2k.png",n.centerX,n.centerY),this.delayTime=t,this.showHideTime=e,this.visibleTime=s,this.alphaStepPerMillisecond=1/this.showHideTime,this.visibleState="emerging",this.isExist=!0,this.alpha=0}update(t){if(this.delayTime>0)this.delayTime-=t;else{switch(this.visibleState){case"emerging":this.alpha+=this.alphaStepPerMillisecond*t,this.alpha>=1&&(this.alpha=1,this.visibleState="visible");break;case"visible":this.visibleTime-=t,this.visibleTime<=0&&(this.visibleState="disappearing");break;default:this.alpha-=this.alphaStepPerMillisecond*t,this.alpha<=0&&(this.alpha=0,this.isExist=!1)}this.alpha<1&&(n.context.save(),n.context.globalAlpha=this.alpha),this.draw(),this.alpha<1&&n.context.restore()}}},H=class extends o{constructor(t,e,s,i,h,r,a){super(t,e,s,{size:i,font:"MicraDi",color:"#ffffff",align:"center"}),this.shadowColor="#0000ff",this.delayTime=h,this.showHideTime=r,this.visibleTime=a,this.alphaStepPerMillisecond=1/this.showHideTime,this.visibleState="emerging",this.isExist=!0,this.alpha=0}update(t){if(this.delayTime>0)this.delayTime-=t;else{switch(this.visibleState){case"emerging":this.alpha+=this.alphaStepPerMillisecond*t,this.alpha>=1&&(this.alpha=1,this.visibleState="visible");break;case"visible":this.visibleTime-=t,this.visibleTime<=0&&(this.visibleState="disappearing");break;default:this.alpha-=this.alphaStepPerMillisecond*t,this.alpha<=0&&(this.alpha=0,this.isExist=!1)}n.context.save(),this.alpha<1&&(n.context.globalAlpha=this.alpha),n.context.shadowBlur=5,n.context.shadowColor=this.shadowColor,n.context.globalCompositeOperation="lighter",this.draw(),n.context.restore()}}},R=class{constructor(t,e,i,h,r,a="left",n="top"){this.tile=s[t],this.x=e,this.y=i,this.width=h,this.height=r,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.img=document.createElement("canvas"),this.img.width=this.width,this.img.height=this.height,this.ctx=this.img.getContext("2d"),this.generateImage(h,r,a,n),this.direction=0}generateImage(t,e,s,i){let h=0,r=0;"center"===s&&(t>this.tile.width&&(h=-Math.floor((this.tile.width-t%this.tile.width)/2)),t<this.tile.width&&(h=-Math.floor((this.tile.width-t)/2))),"right"===s&&(t>this.tile.width&&(h=-(this.tile.width-t%this.tile.width)),t<this.tile.width&&(h=-(this.tile.width-t))),"center"===i&&(e>this.tile.height&&(r=-Math.floor((this.tile.height-e%this.tile.height)/2)),e<this.tile.height&&(r=-Math.floor((this.tile.height-e)/2))),"bottom"===i&&(e>this.tile.height&&(r=-(this.tile.height-e%this.tile.height)),e<this.tile.height&&(r=-(this.tile.height-e)));for(let s=r;s<e;s+=this.tile.height)for(let e=h;e<t;e+=this.tile.width)this.ctx.drawImage(this.tile,e,s)}draw(){0===this.direction?n.context.drawImage(this.img,this.x,this.y):(n.context.setTransform(1,0,0,1,this.x+this.halfWidth,this.y+this.halfHeight),n.context.rotate(this.direction),n.context.drawImage(this.img,-this.halfWidth,-this.halfHeight),n.context.setTransform(1,0,0,1,0,0))}},F=class extends R{constructor(t,e,s){super(t,0,...function(t){const e=(Math.ceil(n.height/t)+1)*t;return[-(e-n.height),n.width,e,"center","bottom"]}(e)),this.restartY=this.tile.height,this.endPointY=this.y+this.tile.height,this.scrollSpeed=s}update(t){this.y+=this.scrollSpeed*t,this.y>this.endPointY&&(this.y-=this.restartY),this.draw()}},O=class extends W{constructor(t,e,s,i,h,r=0){super(t,e,s),this.offsetY=i,this.scrollSpeed=h,this.rotationSpeed=r}update(t){this.rotationSpeed&&(this.direction+=this.rotationSpeed),this.centerY+=this.scrollSpeed*t,this.centerY-this.halfHeight>n.height&&(this.centerY-=this.offsetY+n.height),this.centerY+this.halfHeight>0&&this.centerY-this.halfHeight<n.height&&this.draw()}},$=class{constructor(t,e,i,h,r,a,n=60){this.img=s[t],this.centerX=e,this.centerY=i,this.width=h,this.height=r,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.framesArr=this.getFramesArr(h,r,a),this.frame=0,this.frames=a,this.nextFrameTimeout=Math.floor(1e3/n),this.nextFrameTime=this.nextFrameTimeout,this.direction=0}getFramesArr(t,e,s){const i=[];for(let s=0;s<this.img.height;s+=e)for(let e=0;e<this.img.width;e+=t)i.push({x:e,y:s});return i.length=s,i}drawWithAnimation(t){this.nextFrameTime-=t,this.nextFrameTime<0&&(this.nextFrameTime+=this.nextFrameTimeout,this.frame++,this.frame===this.frames&&(this.frame=0)),0===this.direction?this.draw():(n.context.setTransform(1,0,0,1,this.centerX,this.centerY),n.context.rotate(this.direction),this.draw(-this.halfWidth,-this.halfHeight),n.context.setTransform(1,0,0,1,0,0))}draw(t=this.centerX-this.halfWidth,e=this.centerY-this.halfHeight){n.context.drawImage(this.img,this.framesArr[this.frame].x,this.framesArr[this.frame].y,this.width,this.height,t,e,this.width,this.height)}},L=class extends ${constructor(){super("player_cursor_48x48px_16frames.png",0,0,48,48,16,12)}update(t){this.centerX=rt.x,this.centerY=rt.y,this.drawWithAnimation(t)}},I=class extends W{constructor(t,e,s,i){super("player_bullet_10x40px.png",t,e),this.speed=s,this.damage=i,this.isExist=!0}update(t){this.centerY-=this.speed*t,this.centerY<-this.halfHeight?this.isExist=!1:this.draw()}},B=class extends ${constructor(t,e,s,i,h,r,a=60){super(t,e,s,i,h,r,a),this.direction=Math.random()*Math.PI*2,this.isOnEnd=!1,this.isExist=!0}update(t){this.drawWithAnimation(t),this.frame===this.frames-1&&(this.isExist=!1)}},K=class extends W{constructor(t,e,s,i,h,r){super("player_rocket_30x12px.png",t,e),this.direction=-Math.PI/2,this.speed=s,this.acceleration=i,this.turnSpeed=h,this.damage=r,this.size=12,this.addSmokeTimeout=60,this.addSmokeTime=this.addSmokeTimeout,this.isExist=!0}update(t){let e=null,s=1/0;for(let t=0;t<Xt.length;t++){let i=E(this,Xt[t]);i<s&&(e=Xt[t],s=i)}for(let t=0;t<Et.length;t++){let i=E(this,Et[t]);i<s&&(e=Et[t],s=i)}if(!e){this.isExist=!1;let t=new B("explosion_64x64px_17frames.png",this.centerX,this.centerY,64,64,17,30);return Pt.push(t),void x("se_small_explosion.mp3")}if(M(this,e,this.turnSpeed),y(this,this.speed*t),this.centerY<-this.halfHeight||this.centerY+this.halfHeight>n.height||this.centerX<-this.halfHeight||this.centerX+this.halfHeight>n.width)this.isExist=!1;else{if(this.addSmokeTime-=t,this.addSmokeTime<0){this.addSmokeTime=this.addSmokeTimeout;let t=new B("smoke_32x32px_25frames.png",this.centerX,this.centerY,32,32,25,12);t.direction=Math.random()*(2*Math.PI),kt.push(t)}this.draw(),this.addSmokeTimeout/=this.acceleration,this.speed*=this.acceleration}}},q={up:!1,down:!1,left:!1,right:!1,space:!1,q:!1};document.addEventListener("keydown",(t=>{switch(t.code){case"KeyA":case"ArrowLeft":q.left=!0;break;case"KeyD":case"ArrowRight":q.right=!0;break;case"KeyW":case"ArrowUp":q.up=!0;break;case"KeyS":case"ArrowDown":q.down=!0;break;case"Space":q.space=!0}})),document.addEventListener("keyup",(t=>{switch(t.code){case"KeyA":case"ArrowLeft":q.left=!1;break;case"KeyD":case"ArrowRight":q.right=!1;break;case"KeyW":case"ArrowUp":q.up=!1;break;case"KeyS":case"ArrowDown":q.down=!1;break;case"Space":q.space=!1}console.log("key code :",t.code)}));const U=q,j=class extends ${constructor(){super("player_74x100px_16frames.png",n.centerX,n.height+50,74,100,16,30),this.hp=100,this.scores=0,this.speed=.08,this.hpText=new o("HP: 100%",6,6,{size:20,font:"MicraDi",color:"#ffffff",align:"left"}),this.scoresText=new o("Scores: 0",n.width-6,6,{size:20,font:"MicraDi",color:"#ffffff",align:"right"}),this.size=32,this.bulletSpeed=1.6,this.bulletDamage=10,this.bulletsClip=1,this.bullets=this.bulletsClip,this.shutTimeout=200,this.shutTime=0,this.reloadTimeout=2e3,this.reloadTime=this.reloadTimeout,this.bulletsArr=[],this.rockets=0,this.maxRockets=this.rockets,this.rocketLaunchTimeout=500,this.rocketLaunchTime=this.rocketLaunchTimeout,this.rocketReloadTimeout=2e3,this.rocketReloadTime=this.rocketReloadTimeout,this.rocketStartSpeed=.1,this.rocketAcceleration=1.02,this.rocketTurnSpeed=.05,this.rocketDamage=30,this.rocketsArr=[],this.propertiesText=new o(`Speed: ${(1e3*this.speed).toFixed()} | Rockets: ${this.rockets}/${this.maxRockets}`,n.centerX,6,{size:20,font:"MicraDi",color:"#00ff00",align:"center"})}addScores(t){this.scores+=t,this.scoresText.render(`Scores: ${this.scores}`)}addDamage(t){if(this.hp-=t,this.hp<1){this.bulletsArr=[],this.rocketsArr=[],this.centerY=2*n.height,this.hp=0,this.hpText.render("HP: 0%");let t=new B("explosion_200x200px_18frames.png",this.centerX,this.centerY,200,200,18,30);return Pt.push(t),void x("se_explosion.mp3")}this.hpText.render(`HP: ${this.hp}%`)}update(t){this.reloadTime-=t,this.reloadTime<=0&&(this.reloadTime+=this.reloadTimeout,this.bullets=this.bulletsClip),this.bullets>0&&(this.shutTime-=t,this.shutTime<=0&&(this.shutTime+=this.shutTimeout,this.bulletsClip<4?(this.bullets-=1,this.bulletsArr.push(new I(this.centerX,this.centerY,this.bulletSpeed,this.bulletDamage)),x("se_laser_shut.mp3")):this.bulletsClip<9?(this.bullets-=2,this.bulletsArr.push(new I(this.centerX-15,this.centerY,this.bulletSpeed,this.bulletDamage)),this.bulletsArr.push(new I(this.centerX+15,this.centerY,this.bulletSpeed,this.bulletDamage)),x("se_laser_shut.mp3")):this.bulletsClip<16?(this.bullets-=3,this.bulletsArr.push(new I(this.centerX-30,this.centerY,this.bulletSpeed,this.bulletDamage)),this.bulletsArr.push(new I(this.centerX,this.centerY,this.bulletSpeed,this.bulletDamage)),this.bulletsArr.push(new I(this.centerX+30,this.centerY,this.bulletSpeed,this.bulletDamage)),x("se_laser_shut.mp3")):(this.bullets-=4,this.bulletsArr.push(new I(this.centerX-35,this.centerY,this.bulletSpeed,this.bulletDamage)),this.bulletsArr.push(new I(this.centerX-10,this.centerY,this.bulletSpeed,this.bulletDamage)),this.bulletsArr.push(new I(this.centerX+10,this.centerY,this.bulletSpeed,this.bulletDamage)),this.bulletsArr.push(new I(this.centerX+35,this.centerY,this.bulletSpeed,this.bulletDamage)),x("se_laser_shut.mp3"))));for(let e=0;e<this.bulletsArr.length;e++)this.bulletsArr[e].update(t);if(this.bulletsArr=Y(this.bulletsArr),this.rocketReloadTime>0){if(this.rocketReloadTime-=t,this.rocketReloadTime<=0){let t=`Speed: ${(1e3*this.speed).toFixed()} | Rockets: ${this.rockets}/${this.maxRockets}`;this.propertiesText.render(t)}}else if(this.rockets>0){if(this.rocketLaunchTime>0)this.rocketLaunchTime-=t;else if(rt.isClick||U.space){this.rocketLaunchTime+=this.rocketLaunchTimeout,this.rockets--;const t=new K(this.centerX,this.centerY,this.rocketStartSpeed,this.rocketAcceleration,this.rocketTurnSpeed,this.rocketDamage);this.rocketsArr.push(t),x("se_rocket_launch.mp3");let e=`Speed: ${(1e3*this.speed).toFixed()} | Rockets: ${this.rockets}/${this.maxRockets}`;this.propertiesText.render(e)}}else this.rockets=this.maxRockets,this.rocketReloadTime+=this.rocketReloadTimeout;for(let e=0;e<this.rocketsArr.length;e++)this.rocketsArr[e].update(t);this.rocketsArr=Y(this.rocketsArr),function(t,e,s){if(t.centerX!==e.centerX||t.centerY!==e.centerY){let i=E(t,e);if(i<=s)t.centerX=e.centerX,t.centerY=e.centerY;else{let h=s/i;t.centerX+=h*(e.centerX-t.centerX),t.centerY+=h*(e.centerY-t.centerY)}}}(this,wt,this.speed*t),this.drawWithAnimation(t)}},G=class extends o{constructor(t,e,s){super(t,e,s,{size:20,font:"MicraDi",color:"#ffff00",align:"center"}),this.shadowColor="#ff00ff",this.hideTime=1500,this.visibleTime=500,this.alphaStepPerMillisecond=1/this.hideTime,this.speedY=.02,this.isExist=!0,this.alpha=1}update(t){this.y-=this.speedY*t,1===this.alpha?(this.visibleTime-=t,this.visibleTime<=0&&(this.alpha-=this.alphaStepPerMillisecond*t)):this.alpha-=this.alphaStepPerMillisecond*t,this.alpha<=0?this.isExist=!1:(n.context.save(),this.alpha<1&&(n.context.globalAlpha=this.alpha),n.context.shadowBlur=5,n.context.shadowColor=this.shadowColor,n.context.globalCompositeOperation="lighter",this.draw(),n.context.restore())}},V=class extends ${constructor(t,e,s,i){super("rock_white_50x50px_8frames.png",t,e,50,50,8,18),this.speed=s,this.direction=i,this.damage=5,this.scores=5,this.size=24,this.isExist=!0}addDamage(){this.isExist=!1;let t=new B("explosion_64x64px_17frames.png",this.centerX,this.centerY,64,64,17,30);Pt.push(t),x("se_small_explosion.mp3")}update(t){y(this,this.speed*t);for(let t=0;t<Et.length;t++)if(E(this,Et[t])<this.size+Et[t].size)return Et[t].addDamage(this.damage,this),void(this.isExist=!1);for(let t=0;t<bt.bulletsArr.length;t++)if(bt.bulletsArr[t].isExist&&E(this,bt.bulletsArr[t])<this.size)return bt.bulletsArr[t].isExist=!1,bt.addScores(5),At.push(new G("✛5 SCORES",this.centerX,this.centerY)),void this.addDamage();for(let t=0;t<bt.rocketsArr.length;t++)if(bt.rocketsArr[t].isExist&&E(this,bt.rocketsArr[t])<this.size)return bt.rocketsArr[t].isExist=!1,void this.addDamage();if(E(this,bt)<this.size+bt.size)return bt.addDamage(this.damage),void this.addDamage();this.centerY-this.halfHeight>n.height||this.centerY+this.halfHeight<0||this.centerX-this.halfWidth>n.width||this.centerX+this.halfWidth<0?this.isExist=!1:this.drawWithAnimation(t)}},J=class extends ${constructor(t,e){super("asteroid_white_90x108px_29frames.png",t,e,90,108,29,30),this.direction=Math.random()*(2*Math.PI),this.speed=.04+.04*Math.random(),this.sideSpeed=-this.speed/2+Math.random()*this.speed,this.hp=10+Math.ceil(20*Math.random()),this.damage=20,this.scores=20,this.size=36,this.isExist=!0}addDamage(t,e){if(this.hp-=t,this.hp>0){let t=new B("explosion_64x64px_17frames.png",e.centerX,e.centerY,64,64,17,30);Pt.push(t),x("se_small_explosion.mp3")}else{this.isExist=!1,Mt();let t=new B("explosion_200x200px_18frames.png",this.centerX,this.centerY,200,200,18,30);Pt.push(t),x("se_explosion.mp3"),e!==bt&&this.generateRocks()}}generateRocks(){let t=2+Math.ceil(3*Math.random()),e=2*Math.PI/t;for(let s=0;s<t;s++){let t=e*s+Math.random()*e;yt.push(new V(this.centerX,this.centerY,2*this.speed,t))}}update(t){this.centerY+=this.speed*t,this.centerX+=this.sideSpeed*t;for(let t=0;t<yt.length;t++)if(E(this,yt[t])<this.size+yt[t].size&&(yt[t].isExist=!1,this.addDamage(yt[t].damage,yt[t]),this.hp<=0))return;for(let t=0;t<bt.bulletsArr.length;t++)if(bt.bulletsArr[t].isExist&&E(this,bt.bulletsArr[t])<this.size){if(bt.bulletsArr[t].isExist=!1,this.addDamage(bt.bulletsArr[t].damage,bt.bulletsArr[t]),!(this.hp>0))return bt.addScores(this.scores),void At.push(new G("✛"+this.scores+" SCORES",this.centerX,this.centerY));bt.addScores(1),At.push(new G("✛1 SCORE",this.centerX,this.centerY))}for(let t=0;t<bt.rocketsArr.length;t++)if(bt.rocketsArr[t].isExist&&E(this,bt.rocketsArr[t])<this.size&&(bt.rocketsArr[t].isExist=!1,this.addDamage(bt.rocketsArr[t].damage,bt.rocketsArr[t]),this.hp<=0)){let t=Math.floor(this.scores/2);return bt.addScores(t),void At.push(new G("✛"+t+" SCORES",this.centerX,this.centerY))}if(E(this,bt)<this.size+bt.size)return bt.addDamage(this.damage),void this.addDamage(this.hp,bt);this.centerY-this.halfHeight>n.height||this.centerX-this.halfWidth>n.width||this.centerX+this.halfWidth<0?this.isExist=!1:this.drawWithAnimation(t)}},N=class extends W{constructor(t,e){super("bonus_empty_48x48px.png",t,e),this.type=this.getType(),this.img=s["bonus_"+this.type+"_48x48px.png"],this.speed=.05,this.size=22,this.isExist=!0}getType(){switch(Math.floor(5*Math.random())){case 0:return"bullets";case 1:return"rockets";case 2:return"repair";case 3:return"speed";default:return"scores"}}update(t){if(this.centerY+=this.speed*t,E(this,bt)<this.size+bt.size){let t,e;switch(this.isExist=!1,this.type){case"bullets":bt.bulletsClip+=1,t="✛1 SHUT";break;case"rockets":bt.maxRockets+=1,t="✛1 ROCKET",e=`Speed: ${(1e3*bt.speed).toFixed()} | Rockets: ${bt.rockets}/${bt.maxRockets}`,bt.propertiesText.render(e);break;case"repair":bt.addDamage(-20),t="✛20 HP";break;case"speed":bt.speed*=1.1,t="SPEED ✛10%",e=`Speed: ${(1e3*bt.speed).toFixed()} | Rockets: ${bt.rockets}/${bt.maxRockets}`,bt.propertiesText.render(e);break;default:bt.addScores(100),t="✛100 SCORES"}return At.push(new G(t,this.centerX,this.centerY)),void x("se_bonus.mp3")}this.centerY-this.halfHeight>n.height?this.isExist=!1:this.draw()}},Q=class extends W{constructor(t,e,s){super(t,e,s)}addDamage(t,e){if(this.hp-=t,this.hp>0){let t=new B("explosion_64x64px_17frames.png",e.centerX,e.centerY,64,64,17,30);Pt.push(t),x("se_small_explosion.mp3")}else{this.isExist=!1,Dt();let t=new B("explosion_200x200px_18frames.png",this.centerX,this.centerY,200,200,18,30);Pt.push(t),x("se_explosion.mp3")}}isOnCollision(){for(let t=0;t<bt.bulletsArr.length;t++)if(bt.bulletsArr[t].isExist&&E(this,bt.bulletsArr[t])<this.size){if(bt.bulletsArr[t].isExist=!1,this.addDamage(bt.bulletsArr[t].damage,bt.bulletsArr[t]),!(this.hp>0))return bt.addScores(this.scores),At.push(new G("✛"+this.scores+" SCORES",this.centerX,this.centerY)),this.isWithBonus&&St.push(new N(this.centerX,this.centerY)),!0;bt.addScores(1),At.push(new G("✛1 SCORE",this.centerX,this.centerY))}for(let t=0;t<bt.rocketsArr.length;t++)if(bt.rocketsArr[t].isExist&&E(this,bt.rocketsArr[t])<this.size&&(bt.rocketsArr[t].isExist=!1,this.addDamage(bt.rocketsArr[t].damage,bt.rocketsArr[t]),this.hp<=0)){let t=Math.floor(this.scores/2);return bt.addScores(t),At.push(new G("✛"+t+" SCORES",this.centerX,this.centerY)),!0}return E(this,bt)<this.size+bt.size&&(bt.addDamage(this.damage),this.addDamage(this.hp),!0)}},Z=class extends W{constructor(t,e,s,i){super("enemy_bullet_10x40px.png",t,e),this.speed=s,this.damage=i,this.isExist=!0}update(t){if(this.centerY+=this.speed*t,E(this,bt)<bt.size){this.isExist=!1,bt.addDamage(this.damage);let t=new B("explosion_64x64px_17frames.png",this.centerX,this.centerY,64,64,17,30);return Pt.push(t),void x("se_small_explosion.mp3")}this.centerY>n.height+this.halfHeight?this.isExist=!1:this.draw()}},tt=class extends Q{constructor(t,e){super("enemy_52x78px.png",t,e),this.speed=.06+.06*Math.random(),this.sideSpeed=.12*Math.random()-.06,this.hp=20,this.damage=this.hp,this.scores=this.hp,this.size=24,this.bulletSpeed=.2,this.bulletDamage=5,this.shutTimeout=2e3+Math.floor(1e3*Math.random()),this.shutTime=this.shutTimeout,this.isWithBonus=!1,this.isExist=!0}update(t){if(this.centerY+=this.speed*t,this.centerX+=this.sideSpeed*t,this.centerY>0&&(this.shutTime-=t),this.shutTime<=0){this.shutTime+=this.shutTimeout;const t=new Z(this.centerX,this.centerY,this.bulletSpeed,this.bulletDamage);Ct.push(t)}this.isOnCollision()||(this.centerY-this.halfHeight>n.height||this.centerX-this.halfWidth>n.width||this.centerX+this.halfWidth<0?this.isExist=!1:this.draw())}},et=class extends Q{constructor(t,e){super("enemy_100x130px.png",t,e),this.speed=.04+.04*Math.random(),this.sideSpeed=.02+.02*Math.random(),this.hp=40,this.damage=this.hp,this.scores=this.hp,this.size=46,this.bulletSpeed=.2,this.bulletDamage=5,this.bulletsClip=3,this.bullets=this.bulletsClip,this.shutTimeout=300,this.shutTime=0,this.reloadTimeout=2e3+1e3*Math.random(),this.reloadTime=this.reloadTimeout,this.isWithBonus=!0,this.isExist=!0}update(t){if(this.centerY+=this.speed*t,this.centerX!==bt.centerX){let e=this.sideSpeed*t;Math.abs(this.centerX-bt.centerX)>e?this.centerX>bt.centerX?this.centerX-=e:this.centerX+=e:this.centerX=bt.centerX}if(this.reloadTime-=t,this.reloadTime<=0&&(this.reloadTime+=this.reloadTimeout,this.bullets=this.bulletsClip),this.bullets>0&&(this.shutTime-=t,this.shutTime<=0)){this.shutTime+=this.shutTimeout,this.bullets--;const t=new Z(this.centerX-20,this.centerY,this.bulletSpeed,this.bulletDamage),e=new Z(this.centerX+20,this.centerY,this.bulletSpeed,this.bulletDamage);Ct.push(t),Ct.push(e)}this.isOnCollision()||(this.centerY-this.halfHeight>n.height||this.centerX-this.halfWidth>n.width||this.centerX+this.halfWidth<0?this.isExist=!1:this.draw())}},st=class extends Q{constructor(t,e){super("enemy_170x66px.png",t,e),this.speed=.12+.04*Math.random(),this.turnSpeed=.01,this.hp=30,this.damage=this.hp,this.scores=this.hp,this.size=50,this.isWithBonus=!1,this.isExist=!0}update(t){M(this,bt,this.turnSpeed*t),y(this,this.speed*t),this.isOnCollision()||(this.centerY-this.halfHeight>n.height||this.centerX-this.halfWidth>n.width||this.centerX+this.halfWidth<0?this.isExist=!1:this.draw())}},it=class extends Q{constructor(t,e){super("enemy_102x240px.png",t,e),this.speed=.03+.03*Math.random(),this.hp=100,this.damage=this.hp,this.scores=this.hp,this.size=48,this.isWithBonus=!0,this.isExist=!0}update(t){this.centerY+=this.speed*t,this.isOnCollision()||(this.centerY-this.halfHeight>n.height?this.isExist=!1:this.draw())}},ht=class extends Q{constructor(t,e){super("enemy_186x126px.png",t,e),this.speed=.03+.03*Math.random(),this.turnSpeed=.01,this.hp=70,this.damage=this.hp,this.scores=this.hp,this.size=62,this.shutDistance=n.width>n.height?n.centerY:n.centerX,this.shutDurationTimeout=500,this.shutDurationTime=this.shutDurationTimeout,this.shutDamage=.04,this.shutDamageStorage=0,this.shutTimeout=2e3+Math.floor(1e3*Math.random()),this.shutTime=this.shutTimeout,this.isWithBonus=!0,this.isExist=!0}update(t){if(M(this,bt,this.turnSpeed*t),y(this,this.speed*t),this.shutTime>0)this.shutTime-=t;else if(E(this,bt)<=this.shutDistance)if(this.shutDurationTime>0){if(this.shutDurationTime-=t,this.shutDamageStorage+=this.shutDamage*t,function(t,e,s=null){const i=["#ffe0ff","#e0ffff","#ffffe0"],h=s||i[Math.floor(Math.random()*i.length)];let r=E(t,e),a=Math.ceil(r/4+Math.random()*(r/8));const o=(t,e,s,i)=>{let h=t-s,r=e-i;return Math.sqrt(r*r+h*h)};let l=t.centerX,c=t.centerY;n.context.save(),n.context.lineWidth=2,n.context.strokeStyle=h,n.context.shadowBlur=6,n.context.shadowColor=h,n.context.globalCompositeOperation="lighter",n.context.beginPath(),n.context.moveTo(l,c);for(let t=a;t>1;t--){let s=o(l,c,e.centerX,e.centerY),i=6*Math.sin(s/r*Math.PI);l+=(e.centerX-l)/t+Math.random()*i*2-i,c+=(e.centerY-c)/t+Math.random()*i*2-i,n.context.lineTo(l,c)}n.context.stroke(),n.context.restore()}(this,bt),this.shutDamageStorage>1){let t=+this.shutDamageStorage.toFixed();bt.addDamage(t),this.shutDamageStorage-=t}}else this.shutTime+=this.shutTimeout,this.shutDurationTime+=this.shutDurationTimeout;this.isOnCollision()||(this.centerY-this.halfHeight>n.height||this.centerX-this.halfWidth>n.width||this.centerX+this.halfWidth<0?this.isExist=!1:this.draw())}},rt=navigator.userAgent.indexOf("Android")>0||navigator.userAgent.indexOf("iPhone")>0||navigator.userAgent.indexOf("iPad")>0||navigator.userAgent.indexOf("(X11;")>0?P:D;let at,nt,ot,lt,ct;!function(t,e){r=t.images.arr.length+t.sounds.arr.length;const o=document.createElement("div");function l(){a++,o.innerHTML=`Loaded files: ${a}/${r}`,a===r&&function(){r=0,a=0,o.remove();const t=document.createElement("button");t.id="startButton",t.innerHTML="START",t.onclick=function(){t.remove(),function(){n.canvas.style.cursor="none",dt=new F("scrolling_bg_2000x3400px.png",3400,.01);const t=Math.floor(n.width/3);pt=new O("galaxy_480x420px.png",t,-420,4*n.height,.015,-2e-4),ut=new O("galaxy_480x420px.png",2*t,2*-n.height,4*n.height,.015,-2e-4),mt=new O("black_hole_left_320x320px.png",160,-n.height,48*n.height,.05),gt=new O("black_hole_right_320x320px.png",n.width-160,24*-n.height,48*n.height,.05),xt=new O("planets_920x760px.png",n.centerX,10*-n.height,60*n.height,.06,5e-4),ft=new O("planet_604x588px.png",n.centerX,12*-n.height,90*n.height,.08,6e-4),at=new z(100,1400,1400),nt=new H("Space Warrior",n.centerX,n.centerY-80,120,5500,1500,2500),ot=new H("Scrolling shooter",n.centerX,n.centerY+50,60,8e3,1500,0),lt=new H("Click screen for start game",n.centerX,n.centerY,40,10700,300,1/0),wt=new L,bt=new j,function(t,e,s=0){d.pause(),p=s<e.length?s:0,m=t,u=e,g()}(h.path,h.arr,1),function(t,e=null){t&&(null===b&&document.body.prepend(n.canvas),b=t,e.isFPSdisplay&&(_=!0),e.isPerformanceDisplay&&(k=!0),e.isMusicPlayInOnblur&&(T=!0),w&&cancelAnimationFrame(w),f=performance.now(),w=requestAnimationFrame(A))}(Wt,{isFPSdisplay:!0,isPerformanceDisplay:!0,isMusicPlayInOnblur:!1}),ct=new H("GAME OVER",n.centerX,n.centerY,80,0,1e3,1/0)}()},document.body.append(t)}()}o.id="loadingStatusDiv",o.innerHTML=`Loaded files: ${a}/${r}`,document.body.append(o),t.images.arr.forEach((e=>function(e){s[e]=new Image,s[e].src=t.images.path+e,s[e].onload=()=>l()}(e))),t.sounds.arr.forEach((e=>function(e){i[e]=new Audio,i[e].src=t.sounds.path+e,i[e].oncanplaythrough=t=>{t.target.oncanplaythrough=null,l()}}(e))),h.path=t.music.path,h.arr=t.music.arr}({images:{path:"./src/images/",arr:["MarsGameLogoDarkBg2k.png","scrolling_bg_2000x3400px.png","black_hole_left_320x320px.png","black_hole_right_320x320px.png","galaxy_480x420px.png","planets_920x760px.png","planet_604x588px.png","player_74x100px_16frames.png","player_bullet_10x40px.png","player_rocket_30x12px.png","player_cursor_48x48px_16frames.png","explosion_200x200px_18frames.png","explosion_64x64px_17frames.png","smoke_32x32px_25frames.png","asteroid_white_90x108px_29frames.png","rock_white_50x50px_8frames.png","enemy_52x78px.png","enemy_100x130px.png","enemy_170x66px.png","enemy_102x240px.png","enemy_186x126px.png","enemy_bullet_10x40px.png","bonus_empty_48x48px.png","bonus_bullets_48x48px.png","bonus_repair_48x48px.png","bonus_rockets_48x48px.png","bonus_scores_48x48px.png","bonus_speed_48x48px.png"]},sounds:{path:"./src/sounds/",arr:["se_explosion.mp3","se_small_explosion.mp3","se_laser_shut.mp3","se_rocket_launch.mp3","se_bonus.mp3"]},music:{path:"./src/music/",arr:["bgm_space_1.mp3","bgm_space_2.mp3","bgm_space_3.mp3"]}});let dt,pt,ut,mt,gt,xt,ft,wt,bt,Tt=!1,_t=11e3,kt=[],St=[],At=[],Xt=[],Yt=3;function Mt(){Yt+=.3}let yt=[],Et=[],vt=2;function Dt(){vt+=.2}let Ct=[],Pt=[];function Wt(t){if(dt.update(t),!Tt)return _t>0?(_t-=t,!0===at.isExist&&at.update(t),!0===nt.isExist&&nt.update(t),!0===ot.isExist&&ot.update(t),void lt.update(t)):(lt.update(t),void(rt.isClick&&(lt.visibleTime=0,setTimeout((()=>{at.isExist=!1,nt.isExist=!1,ot.isExist=!1,lt.isExist=!1,Tt=!0}),500))));pt.update(t),ut.update(t),mt.update(t),gt.update(t),xt.update(t),ft.update(t),wt.update(t);for(let e=0;e<St.length;e++)St[e].update(t);St=Y(St);for(let e=0;e<kt.length;e++)kt[e].update(t);kt=Y(kt);for(let e=0;e<yt.length;e++)yt[e].update(t);yt=Y(yt);for(let e=0;e<Ct.length;e++)Ct[e].update(t);Ct=Y(Ct),Et.length<vt&&function(){let t,e=Math.random()*n.width,s=-Math.random()*(n.height/2)-240;switch(Math.floor(Math.random()*Math.floor(vt))){case 0:case 1:t=new tt(e,s);break;case 2:case 3:t=new et(e,s);break;case 4:t=new st(e,s);break;case 5:t=new it(e,s);break;default:t=new ht(e,s)}Et.push(t),console.log(Et)}();for(let e=0;e<Et.length;e++)Et[e].update(t);Et=Y(Et),Xt.length<Yt&&function(){let t=Math.random()*n.width,e=-Math.random()*n.centerX;Xt.push(new J(t,e))}();for(let e=0;e<Xt.length;e++)Xt[e].update(t);Xt=Y(Xt),bt.hp>0?bt.update(t):ct.update(t);for(let e=0;e<Pt.length;e++)Pt[e].update(t);Pt=Y(Pt);for(let e=0;e<At.length;e++)At[e].update(t);At=Y(At),bt.propertiesText.draw(),bt.scoresText.draw(),bt.hpText.draw()}app=e})();